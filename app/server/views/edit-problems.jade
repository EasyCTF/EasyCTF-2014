extends layout

block content
	style.
		.NO_HOVER_UNDERLINE_DAMMIT, .NO_HOVER_UNDERLINE_DAMMIT:hover, .NO_HOVER_UNDERLINE_DAMMIT:active {
			text-decoration:none;
		}
	div(class='wrapper')
		div(class='main')
			section(id='page1')
				div(class='page-container')
					if logged
						if group == 3
							div(class='page-header')
								h2 Edit Problems
							div.panel.panel-default
								div.panel-heading
									a.NO_HOVER_UNDERLINE_DAMMIT(style='font-size:16pt;', data-toggle='collapse', data-parent='#accordion', href='#collapse-create')
										| Create a New Problem
								div.panel-collapse.collapse#collapse-create
									div.panel-body
										form.form-horizontal(action='javascript:create_problem();')
											table.table.table-striped(cellpadding='5')
												tr
													td
														div
															label(for='create-title') Title
														div
															small
																i Keep it short
													td
														input.form-control#create-title(type='text', autocomplete='off')
												tr
													td
														div
															label(for='create-text') Problem Statement
														div
															small
																i Use HTML formatting
													td
														textarea.form-control#create-text
												tr
													td
														div
															label(for='create-answer') Answer
														div
															small
																i Don't hash it
													td
														input.form-control#create-answer(type='text', autocomplete='off')
												tr
													td(colspan='2')
														- each tag in tags
															- var dname = "create-check-tag" + tag.id;
															- var r = Math.floor(tag.color / (256 * 256));
															- var g = Math.floor((tag.color % (256 * 256)) / 256);
															- var b = tag.color % 256;
															style.
																.label-#{dname} {
																	background-color:rgb(#{r}, #{g}, #{b});
																	color: #FFF;
																}
															input(type="checkbox", name="#{dname}", id="#{dname}")
															label(for="#{dname}", class="label label-#{dname} tag-c-label") #{tag.name}
												tr
													td
													td(style='text-align:right;')
														input(type='submit', value='Create', class='btn btn-primary')
										div#problem-created.alert.alert-success(style='display:none;')
										div#problem-create-error.alert.alert-danger(style='display:none;')
							script.
								var create_problem = function() {
									$("[id^=problem-create]").slideUp("fast");
									$("[id^=create-]").attr("disabled", "disabled");
									var tagVal = 0;
									var totalTags = $(".tag-c-label").length;
									for(var i=0;i<totalTags;i++) {
										var elem = $("#create-check-tag" + (i+1));
										if (elem.is(":checked")) {
											tagVal += Math.pow(2, (i+1));
										}
									}
									$.ajax({
										url: "/edit/create.ajax",
										dataType:"json",
										type: "POST",
										data: {
											pTitle: $("#create-title").val(),
											pStatement: $("#create-text").val(),
											pAnswer: $("#create-answer").val(),
											pValue: $("#create-value").val(),
											pTags: tagVal,
										},
										success: function(content) {
											if (content.ret == 1) {
												$("#problem-created").html("Problem was created!");
												$("#problem-created").slideDown("fast");
												setTimeout(function() {
													window.location.reload(true);
												}, 2000);
											} else if (content.ret == 0) {
												$("#problem-create-error").html(content.error);
												$("#problem-create-error").slideDown("fast");
												$("[id^=create-]").removeAttr("disabled");
											}
										},
										error: function() {
											$("#problem-create-error").html("Could not connect?");
											$("#problem-create-error").slideDown("fast");
											$("[id^=create-]").removeAttr("disabled");
										}
									});
								};
							script(type='text/javascript', src='/lib/ckeditor/ckeditor.js')
							script.
								CKEDITOR.replace("create-text")
						else
							div(class='alert alert-danger').
								<b>Error:</b> You must be admin to view this page!
					else
						div(class='alert alert-danger').
							<b>Error:</b> You must be logged in to view this page!